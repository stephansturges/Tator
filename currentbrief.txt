High priority (atomic, guardrails on)
- Agent recipes (done): preserve step fields (incl. similarity_score/metadata) and merge params from both roots; guard against empty-after-normalize.
- Recipe portability (done core): zip-only import/export, recipes always saved locally (no legacy JSON), schema/threshold validation, labelmap required, crop path sanitize + size/count caps, relative paths, no dataset references in artifacts (import no longer requires dataset id); open: add schema validation at load-time UI, ensure no legacy JSON uploads relied on.
- Mining cache/splits: cache keys must include dataset signature + split seed/val%; already added signature/context; size/TTL pruning + purge-block on active jobs added; still consider LRU and explicit lock-out during long jobs if needed.
- Base64/inference limits: shared decoder with 413 is in; mask count/size caps added (env: MAX_RESPONSE_DETECTIONS/MAX_RESPONSE_MASKS/MASK_ENCODE_MAX_BYTES); preload cache has byte cap (SAM_PRELOAD_MAX_BYTES); still consider applying limits to other endpoints/caches if needed.
- Upload safety (done core): sanitize ZIP entries (reject ..//abs) for qwen/dataset manager; size/quota caps added for dataset/zips + chunked uploads; classifier/labelmap uploads now size/extension capped with quota and reject overwrite; agent-recipe import now streams with size/quota caps; predict_base64 capped; CLIP training uploads (images/labels/labelmap) now per-file + quota capped. Defaults are now very high (up to ~100GB quotas) for LAN use; still overridable via env. Remaining: audit any other generic uploads for type/quota, keep TTL/purge staging dirs.
  Defaults are now generous (GB-scale) for LAN use; still overridable via env.
- CLIP activation safety (done): whitelist classifier/labelmap paths/backbones; reject untrusted pickle/labelmaps; verify labelmap class count vs classifier before activate/infer; allowed classifier exts .pkl/.joblib and labelmap exts .txt/.pkl enforced; labelmap required when classes present.
- FS helpers (trimmed): removed the backend directory picker; keep only classifier/labelmap upload routes (size/type limited). Remaining: optional auth/role guard on any future FS helper routes.
- Dataset resolution/deletion (partially done): deterministic source selection when ids/signatures collide; surface duplicates in UI; block delete when in use; purge derived artifacts (splits, mining caches, prompt-helper) on delete. (Agent-mining meta/cache and prompt-helper presets now purged on dataset delete incl. Qwen route)
- Staging purges: stale staging dirs are cleaned with prefix filters to avoid deleting real datasets; still need periodic housekeeping/controls surfaced in UI.
- Training preflight: CLIP create output_dir if missing and validate staged/native uploads (images+labels present, boxes>0, labelmap covers IDs). Qwen run_name collision guard; ensure annotations/classes non-empty for random/custom splits. SAM3: require images+labels/classes>0 and non-empty train/val; TTL/purge aborted runs. (Qwen run_name collision + empty/classless split checks added)
- Model lists/activation: SAM3 prompt models list promoted+non-promoted with variant/seg flags; activation honors segmentation flag/checkpoint/key. Qwen models list validated/escaped, marks true active, refreshes limits on activation/API change, surfaces errors.
- SAM3 visual prompt: apply sigmoid then threshold, clamp mask_threshold to [0,1], server-side dedupe exemplar/overlaps.
- Prompt expansion (GPT-OSS): add timeouts/backoff; avoid sticky load error; log dropped candidates; relax parsing fallback; make Qwen refine optional.
- Job registries: TTL/prune added across CLIP/Qwen/SAM3/agent/prompt-helper/seg-build listings; still need persistence/log tail if desired and tighter cancel/cache-skip guarantees.
- Active model UI drift: only set fields after successful upload; clear on failure; auto-refresh active info/backbones on tab open/API-root change; guard upload size/type.
- Predictor settings: clamp max_predictors server-side; surface errors/stale polling; stop polling when unsupported; clear stats on API-root change.
- Labelmap/hash awareness: persist hash/name with annotations/recipes; warn/block apply/save/export when labelmap differs; keep artifacts portable (no hash coupling).
- Dataset splits (other flows): agent mining uses seeded full-dataset split; Qwen/SAM3 now enforce seeded splits and non-empty train/val; CLIP not applicable (classification flow).

Medium priority
- Agent mining: portable recipes only; add cache size/TTL + UI purge; warn on empty train/val in test mode; ensure progress bars reach 100% on completion/stall detection; inline class info on apply, warn on missing crops, sanitize paths/schema; allow mismatch warnings without blocking; ensure override respected. (Split logging now reports train/val counts/test mode)
- Prompt helper deprecation: hide legacy UI/endpoints; add purge/TTL for old jobs/presets; dedupe routes.
- Annotation import/export: clamp coords to bounds; summarize skipped classes; validate polygons (points/area, optional self-intersection); warn on dense polygons; surface active labelmap name/hash; keep exports portable.
- Polygon annotator UX: clear drafts on mode switch; min points/area guard; warn on collapsed polygons post-simplify.
- Segmentation builder: preflight bbox datasets (labels>0, class ids valid); clamp/cap copies; handle overwrite/rename; clean partial outputs; UI blocks non-bbox/empty, better logs/progress, pause polling on tab leave.
- SAM preload/predictors: surface preload errors/status; key promises by image+variant; flush on variant change; gate neighbor preloads on supported slots; byte-based cache cap; preload progress indicator.
- Upload collisions/quotas: per-type size/quota; unique filenames (uuid) or reject overwrite; housekeeping/purge controls.
- CLIP embeddings reuse: validate cache (dataset hash/backbone) before reuse; disable if incompatible/missing; warn in UI.
- Training job UI: stale indicator; progress clamp to 100% on terminal states; logs paged/limited with truncation notice.
- Dataset manager UI: show root/source/type; auto-refresh on API-root change; warn on id/signature collisions; sanitize zip; validate splits/labels before register; delete confirms downstream purge.
- SAM3/Qwen/CLIP training jobs: TTL/prune registries; cleanup partial outputs on cancel/fail; serialize model switches to avoid OOM.
- Settings/API root + fuzzer: cancel pollers/clear caches on root change; fuzzer per-test timeout, re-enable button, allow testing candidate root; validate response body not just HTTP.
- COCO export: add COCO (bbox+polygons) export path; preserve category IDs/names.

Low priority / backlog
- Auth/CORS: optional API key/protected mode, warn banner when wide-open; restrict sensitive endpoints when unauthenticated.
- Annotation extras: repair option for out-of-range coords; show image-dim warnings; expose polygon simplify epsilon consistently.
- SAM mask polygon: harmonize simplify epsilon defaults; consider self-intersection clip or fallback to bbox.
- Cross-class cleanup/beam search: optional stacked/beam search with toggles; reuse caches when available; integrate hard negatives/cross-class FP pruning without regressing current path.

Notes for implementation
- Keep portability: no embedding labelmap hashes in exported artifacts; recipes/datasets must move across machines unchanged.
- Prefer small, reversible changes; fail fast with clear user-facing errors over silent fixes.
- Update UI help/tooltips when adding controls (seeds, limits, size caps); ensure progress bars reach 100% on completion.
